<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario - Node Express</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">
  <div class="container">
    <h2 class="mb-4 text-center">Formulario - Node Express</h2>

    <form id="userForm" class="border p-4 bg-white rounded shadow-sm">
      <div class="row mb-3">
        <div class="col-md-3">
          <label class="form-label">DNI</label>
          <input type="text" class="form-control" id="dni" required>
        </div>
        <div class="col-md-3">
          <label class="form-label">Nombres</label>
          <input type="text" class="form-control" id="nombre" required>
        </div>
        <div class="col-md-3">
          <label class="form-label">Apellidos</label>
          <input type="text" class="form-control" id="apellido" required>
        </div>
        <div class="col-md-3">
          <label class="form-label">Fecha Nac.</label>
          <input type="date" class="form-control" id="fecha" required>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label d-block">Género</label>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="genero" value="Masculino" checked>
          <label class="form-check-label">Masculino</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="genero" value="Femenino">
          <label class="form-check-label">Femenino</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="genero" value="Otro">
          <label class="form-check-label">Otro</label>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Ciudad</label>
        <select id="ciudad" class="form-select" required>
          <option value="">-- seleccionar --</option>
          <option>Guayaquil</option>
          <option>Quito</option>
          <option>Cuenca</option>
          <option>Manta</option>
        </select>
      </div>

      <button type="submit" class="btn btn-primary">Registrar</button>
      <button type="reset" class="btn btn-secondary">Limpiar</button>
    </form>

    <hr>

    <h4 class="mt-4">Registros</h4>
    <table class="table table-striped mt-3" id="usersTable">
      <thead>
        <tr>
          <th>#</th>
          <th>DNI</th>
          <th>Nombre</th>
          <th>Ciudad</th>
          <th>Género</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const API_URL = '/api/users';

    const form = document.getElementById('userForm');
    const tableBody = document.querySelector('#usersTable tbody');
    let editingId = null;

    const loadUsers = async () => {
      const res = await fetch(API_URL);
      const users = await res.json();
      tableBody.innerHTML = '';
      users.forEach((u, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i + 1}</td>
          <td>${u.dni}</td>
          <td>${u.nombre} ${u.apellido}</td>
          <td>${u.ciudad}</td>
          <td>${u.genero}</td>
          <td>
            <button class="btn btn-info btn-sm me-2" onclick="editUser(${u.id})">Editar</button>
            <button class="btn btn-danger btn-sm" onclick="deleteUser(${u.id})">Eliminar</button>
          </td>
        `;
        tableBody.appendChild(tr);
      });
    };

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const user = {
        dni: document.getElementById('dni').value,
        nombre: document.getElementById('nombre').value,
        apellido: document.getElementById('apellido').value,
        fecha: document.getElementById('fecha').value,
        genero: document.querySelector('input[name="genero"]:checked').value,
        ciudad: document.getElementById('ciudad').value,
      };

      if (editingId) {
        await fetch(`${API_URL}/${editingId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(user)
        });
        editingId = null;
      } else {
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(user)
        });
      }

      form.reset();
      loadUsers();
    });

    const deleteUser = async (id) => {
      await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
      loadUsers();
    };

    const editUser = async (id) => {
      const res = await fetch(API_URL);
      const users = await res.json();
      const u = users.find(user => user.id == id);
      if (!u) return;

      document.getElementById('dni').value = u.dni;
      document.getElementById('nombre').value = u.nombre;
      document.getElementById('apellido').value = u.apellido;
      document.getElementById('fecha').value = u.fecha;
      document.querySelector(`input[value="${u.genero}"]`).checked = true;
      document.getElementById('ciudad').value = u.ciudad;

      editingId = id;
    };

    loadUsers();
  </script>
</body>
</html>

